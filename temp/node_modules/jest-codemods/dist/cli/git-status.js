'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = checkGitStatus;

var _chalk = require('chalk');

var _chalk2 = _interopRequireDefault(_chalk);

var _isGitClean = require('is-git-clean');

var _isGitClean2 = _interopRequireDefault(_isGitClean);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function checkGitStatus(force) {
    let clean = false;
    let errorMessage = 'Unable to determine if git directory is clean';
    try {
        clean = _isGitClean2.default.sync(process.cwd());
        errorMessage = 'Git directory is not clean';
    } catch (err) {
        if (err && err.stderr && err.stderr.indexOf('Not a git repository') >= 0) {
            clean = true;
        }
    }

    if (!clean) {
        if (force) {
            console.log(`WARNING: ${errorMessage}. Forcibly continuing.`);
        } else {
            console.log(_chalk2.default.red(`\nERROR: ${errorMessage}. Refusing to continue.`));
            console.log('Ensure you have a backup of your tests or commit the latest changes before continuing.');
            console.log('You may use the --force flag to override this safety check.');
            process.exit(1);
        }
    }
}